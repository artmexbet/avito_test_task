# Реализация тестового в Avito
## Описание
Упор сделал на тесты. Старался писать продуктовый код так, будто это реальный проект.
Использовал чистую архитектуру, слои разделены по папкам.
Где-то явно виден оверинжиниринг, но это сделано специально, чтобы показать подход к написанию кода.

Написал юнит и интеграционные тесты (покрытие небольшое, но это честная работа).
![это не много, но это честная работа](https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Это_немного%2C_но_это_честная_работа.jpg/500px-Это_немного%2C_но_это_честная_работа.jpg)
## Запуск
Описание запуска лежит в [Makefile](Makefile).

Предполагается, что необходимый софт (о нём ниже) установлен на хост-машине.
### Необходимый софт
- Go 1.21+
- Docker и docker-compose
- Make*
- K6* (для нагрузочного тестирования)
- Golangci-lint* (для линтинга)
- Mockery* (для генерации моков)

\* - можно не устанавливать, если не планируется использовать соответствующие команды Makefile
### Команды Makefile
- `make build` — сборка бинарника
- `make run` — запуск сервиса (поднимает бд и сам сервис)
- `make test` — запуск юнит-тестов
- `make test-integration` — запуск интеграционных тестов
- `make lint` — запуск линтера
- `make up` — поднятие сервиса с бд через docker-compose
- `make down` — остановка сервиса и бд через docker-compose
- `make mock` — генерация моков для интерфейсов
## Нагрузочное тестирование
Для нагрузочного тестирования использовал k6.
Сценарий находится в папке `load_test`.


[Отчёт](load_testing/RESULT.md) по результатам нагрузочного тестирования находится в папке `load_testing`.
## Комментарии по реализации
Кажется, есть некоторые эндпоинты, где сигнатура чуть-чуть отличается, но в целом старался соответствовать спеке.

Про реализацию сбора статистики: сам процесс сбора у меня не очень - каждый раз вытаскиваю из БД и считаю. 
В реальном проекте, наверное, лучше бы завести отдельную таблицу для статистики и обновлять её при каждом изменении данных.
А ещё лучше - подключить прометея :))

Ещё докинул swagger на `/docs`

Остальные допущения по пунктам:
1. В спеке указано, что ID всех сущностей приходит вместе с запросом. Значит надо и в бд хранить их теми же строками
2. Можно было вынести отдельные типы для ID сущностей (на случай изменений), но решил оставить стрингой для упрощения
3. Закинул отдельный слой репозитория над постгресом на случай, если в будущем понадобится сменить бд/добавить кеширование/отправку в топики и тому подобное
